# План доработки игры «Золотой Запас» (Match-3)

## Общая концепция
Превратить демо-заглушку в полноценную match-3 игру с интеграцией бустера «Газпромбанк Бонус» согласно концепции из game-tz/3-v-ryad.md.

## Цель MVP
Создать 20-30 секундный демо-сценарий, демонстрирующий:
- Работающую механику match-3
- Систему зарядки бустера через комбинации
- Применение бустера «Бонус-Ракета» с взрывом 3x3
- Достижение цели по очкам
- Связь с продуктом «Газпромбанк Бонус»

---

## Итерация 1: Базовая архитектура и состояние игры
**Объем работ:** ~10%
**Цели:**
- Создать TypeScript интерфейсы для игрового состояния
- Реализовать основные типы (Cell, GameState, Position)
- Настроить Svelte stores для управления состоянием
- Создать базовую структуру классов/функций

**Задачи:**
- Определить типы фишек: `coin`, `sapphire`, `emerald`, `gold`
- Создать интерфейс `GameState` с полями score, moves, boosterCharge
- Реализовать `gameField` как реактивный store
- Создать enum для статусов игры: `playing`, `targeting`, `completed`
- Базовая валидация состояния

---

## Итерация 2: Динамическое игровое поле
**Объем работ:** ~10%
**Цели:**
- Заменить статический массив на динамическую генерацию
- Реализовать алгоритм заполнения поля без начальных комбинаций
- Создать функции перемешивания и проверки возможных ходов

**Задачи:**
- Функция `generateField()` для создания случайного поля 8x8
- Алгоритм `checkInitialMatches()` для предотвращения стартовых комбинаций
- Функция `shuffleField()` для перемешивания
- Функция `hasPossibleMoves()` для проверки доступных ходов
- Обновить отрисовку поля под новую структуру данных

---

## Итерация 3: Механика выбора и свапа фишек
**Объем работы:** ~10%
**Цели:**
- Реализовать выбор фишек кликом
- Добавить логику свапа соседних фишек
- Создать валидацию корректности ходов

**Задачи:**
- Состояние `selectedCell` для отслеживания выбранной фишки
- Функция `selectCell(row, col)` с подсветкой выбранной клетки
- Функция `swapCells(from, to)` для обмена фишек
- Валидация `isValidSwap()` - только соседние клетки
- Анимация свапа с `transition` (базовая)
- Откат неудачного свапа

---

## Итерация 4: Детекция и обработка комбинаций
**Объем работ:** ~10%
**Цели:**
- Алгоритм поиска комбинаций 3+ в ряд
- Удаление найденных комбинаций
- Подсчет типов комбинаций (3, 4, 5+ элементов)

**Задачи:**
- Функция `findMatches()` для поиска горизонтальных/вертикальных линий
- Функция `removeMatches()` с пометкой клеток для удаления
- Функция `classifyMatches()` для определения размера комбинаций
- Каскадная проверка после удаления
- Базовое падение фишек после удаления

---

## Итерация 5: Система очков и ходов
**Объем работ:** ~10%
**Цели:**
- Подсчет очков за разные типы комбинаций
- Учет ходов и условий победы/поражения
- Интеграция с UI счетчиков

**Задачи:**
- Формула начисления очков: 3 в ряд = 100, 4 в ряд = 300, 5+ в ряд = 500
- Функция `updateScore(matchType, count)`
- Счетчик ходов с уменьшением после каждого valid move
- Условие победы: достижение целевого количества очков (5000)
- Условие поражения: ходы закончились
- Анимация изменения счета

---

## Итерация 6: Система бустера и зарядка
**Объем работ:** ~10%
**Цели:**
- Шкала зарядки бустера «Газпромбанк Бонус»
- Логика зарядки от больших комбинаций
- UI элементы бустера

**Задачи:**
- Шкала `boosterCharge` от 0 до 100
- Зарядка: 4 в ряд = +30, 5+ в ряд = +50, L/T формы = +40
- UI компонент шкалы с градиентом брендовых цветов
- Кнопка бустера с логотипом "Газпромбанк Бонус"
- Состояние кнопки: неактивная/активная/сияющая
- Функция `chargeBooster(matchType)`

---

## Итерация 7: Применение бустера «Бонус-Ракета»
**Объем работ:** ~10%
**Цели:**
- Режим нацеливания бустера
- Взрыв области 3x3 вокруг выбранной точки
- Обработка результата взрыва

**Задачи:**
- Режим `targeting` при активации бустера
- Визуальное изменение курсора/интерфейса в режиме нацеливания
- Функция `applyBooster(targetRow, targetCol)` для взрыва 3x3
- Расчет области взрыва с учетом границ поля
- Удаление всех фишек в области взрыва
- Большое начисление очков за применение бустера (1000+ очков)
- Сброс заряда бустера до 0

---

## Итерация 8: Анимации и визуальные эффекты
**Объем работ:** ~10%
**Цели:**
- Плавные анимации для всех игровых действий
- Эффектный взрыв бустера
- Полировка визуального опыта

**Задачи:**
- Анимация падения фишек после удаления комбинаций
- Плавное заполнение шкалы бустера
- Эффект сияния активированной кнопки бустера
- **Ключевая анимация**: взрыв 3x3 с particles, вспышкой, sound effect
- Анимация cascade падения новых фишек сверху
- Transition для смены счета очков
- Micro-анимации hover/active состояний

---

## Итерация 9: Демо-сценарий и обучение
**Объем работ:** ~10%
**Цели:**
- Создать управляемый демо-сценарий согласно концепции
- Добавить подсказки и обучающие элементы
- Интегрировать финальный экран с продуктом

**Задачи:**
- Предзаготовленное поле с гарантированными комбинациями 4+ элементов
- Подсветка рекомендуемых ходов для зарядки бустера
- Текстовые подсказки: "Бонус готов! Выберите цель!"
- Сценарий: 2 хода → зарядка → применение → победа
- Экран победы с текстом о программе "Газпромбанк Бонус"
- Кнопка "Узнать больше о программе" (неактивная)

---

## Итерация 10: Финальная полировка и интеграция
**Объем работ:** ~10%
**Цели:**
- Оптимизация производительности
- Финальное тестирование и отладка
- Интеграция с игровой экосистемой

**Задачи:**
- Оптимизация алгоритмов поиска комбинаций
- Тестирование на разных разрешениях экрана
- Проверка доступности (keyboard navigation, screen readers)
- Интеграция с общей системой очков/статистики
- Фикс багов и edge cases
- Финальная настройка баланса (таймингов, количества очков)
- Подготовка к интеграции в основное приложение

---

## Технические детали

### Структура файлов:
```
src/games/match3-golden-reserve/
├── Match3Game.svelte          # Основной компонент (переименовать из Match3Demo)
├── gameLogic.ts              # Логика игры и алгоритмы
├── gameState.ts              # Svelte stores для состояния
├── types.ts                  # TypeScript интерфейсы
├── animations.ts             # Утилиты для анимаций
└── constants.ts              # Константы игры
```

### Ключевые константы:
- Размер поля: 8x8
- Целевой счет: 5000 очков
- Количество ходов: 5 (для демо)
- Типы фишек: coin, sapphire, emerald, gold
- Зарядка бустера: 4 в ряд = 30%, 5+ в ряд = 50%

### Интеграция продукта:
- Логотип "Газпромбанк Бонус" на кнопке бустера
- Фирменные цвета в UI элементах
- Образовательный текст в финальном экране
- Связь механики игры с реальной пользой программы лояльности